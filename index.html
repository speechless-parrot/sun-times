<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sun + Fajr times üåÖ</title>
    <link href="https://fonts.googleapis.com/css2?family=Google+Sans:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@20..48,100..700,0..1,0" />
    <style>
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    font-family: 'Google Sans', sans-serif;
}

body {
    background: linear-gradient(135deg, #1a237e, #311b92);
    color: white;
    min-height: 100vh;
    padding: 2rem;
    display: flex;
    flex-direction: column;
    align-items: center;
}

.container {
    max-width: 1200px; /* Increased for grid layout */
    width: 100%;
    margin: 0 auto;
}

.location {
    background: rgba(255, 255, 255, 0.1);
    padding: 1rem 2rem;
    border-radius: 16px;
    margin-bottom: 2rem;
    backdrop-filter: blur(10px);
    display: flex;
    align-items: center;
    gap: 0.5rem;
    width: 100%;
}

/* New grid layout for cards üéØ */
.cards-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 1.5rem;
    width: 100%;
}

.time-card {
    background: rgba(255, 255, 255, 0.1);
    padding: 2rem;
    border-radius: 24px;
    backdrop-filter: blur(10px);
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    height: 100%;
    display: flex;
    flex-direction: column;
    position: relative;
    overflow: hidden;
}

.time-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.2);
    background: rgba(255, 255, 255, 0.15);
}

.time-header {
    display: flex;
    align-items: center;
    gap: 1rem;
    margin-bottom: 1rem;
}

.time-title {
    font-size: 1.25rem;
    font-weight: 500;
    letter-spacing: 0.5px;
}

.material-symbols-rounded {
    font-size: 2rem;
    font-variation-settings: 'FILL' 1;
}

.countdown {
    font-size: 2rem;
    font-weight: 700;
    margin: 1rem 0;
    text-align: center;
    letter-spacing: 1px;
}

.actual-time {
    color: rgba(255, 255, 255, 0.7);
    font-size: 1rem;
    margin-top: auto;
    padding-top: 1rem;
    border-top: 1px solid rgba(255, 255, 255, 0.1);
}

.passed {
    color: rgba(255, 255, 255, 0.5);
}

@keyframes pulse {
    0% { transform: scale(1); }
    50% { transform: scale(1.02); }
    100% { transform: scale(1); }
}

.active {
    animation: pulse 2s infinite;
    border: 2px solid rgba(255, 255, 255, 0.3);
}

.active::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 3px;
    background: linear-gradient(to right, #64b5f6, #2196f3);
    border-radius: 3px;
}

/* Responsive design for smaller screens üì± */
@media (max-width: 900px) {
    .cards-grid {
        grid-template-columns: repeat(2, 1fr);
    }
}

@media (max-width: 600px) {
    .cards-grid {
        grid-template-columns: 1fr;
    }
    
    .container {
        padding: 1rem;
    }
    
    .time-card {
        padding: 1.5rem;
    }
}

/* Cool hover effects ‚ú® */
.time-card .material-symbols-rounded {
    transition: transform 0.3s ease;
}

.time-card:hover .material-symbols-rounded {
    transform: scale(1.1) rotate(5deg);
}

/* Smooth loading states üîÑ */
.loading {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    color: rgba(255, 255, 255, 0.7);
}

.loading .material-symbols-rounded {
    animation: spin 1s linear infinite;
}

@keyframes spin {
    100% { transform: rotate(360deg); }
}
/* Add these new styles */
.tabs {
    display: flex;
    gap: 1rem;
    margin-bottom: 2rem;
    background: rgba(255, 255, 255, 0.1);
    padding: 0.5rem;
    border-radius: 12px;
    backdrop-filter: blur(10px);
}

.tab {
    padding: 0.75rem 1.5rem;
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-weight: 500;
    user-select: none;
}

.tab.active {
    background: rgba(255, 255, 255, 0.2);
}

.tab:hover {
    background: rgba(255, 255, 255, 0.15);
}

.weekly-view {
    display: none;
    grid-template-columns: 1fr;
    gap: 1rem;
    width: 100%;
}

.weekly-view.active {
    display: grid;
}

.day-card {
    background: rgba(255, 255, 255, 0.1);
    padding: 1.5rem;
    border-radius: 24px;
    backdrop-filter: blur(10px);
    display: grid;
    grid-template-columns: auto 1fr 1fr 1fr;
    gap: 2rem;
    align-items: center;
    transition: all 0.3s ease;
}

.day-card:hover {
    background: rgba(255, 255, 255, 0.15);
    transform: translateX(5px);
}

.day-name {
    font-weight: 500;
    font-size: 1.1rem;
    color: rgba(255, 255, 255, 0.9);
    min-width: 100px;
}

.time-group {
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.time-group .material-symbols-rounded {
    font-size: 1.25rem;
    opacity: 0.7;
}
.time-group {
    display: flex;
    align-items: center;
    gap: 1rem;
}

.time-group .material-symbols-rounded {
    font-size: 1.5rem;
    opacity: 0.8;
}

.time-label {
    display: flex;
    flex-direction: column;
    gap: 0.25rem;
}

.time-label .label {
    font-size: 0.85rem;
    color: rgba(255, 255, 255, 0.7);
    font-weight: 500;
}

.time-label .time {
    font-size: 1.1rem;
    color: rgba(255, 255, 255, 0.9);
}

/* Make the day cards a bit roomier */
.day-card {
    padding: 1.75rem;
    gap: 2.5rem;
}

/* Add a subtle hover state */
.day-card:hover .material-symbols-rounded {
    opacity: 1;
    transform: scale(1.1);
    transition: all 0.3s ease;
}
    </style>
</head>
<body>
<div class="container">
    <div class="location">
        <span class="material-symbols-rounded">location_on</span>
        <span id="location-text">Loading location... üìç</span>
    </div>

<div class="tabs">
    <div class="tab active" data-view="today">
        <span class="material-symbols-rounded">today</span>
        Today's Times
    </div>
    <div class="tab" data-view="weekly">
        <span class="material-symbols-rounded">calendar_month</span>
        Week Ahead
    </div>
</div>

    <div class="cards-grid">
        <div class="time-card" id="fajr-card">
            <div class="time-header">
                <span class="material-symbols-rounded">nightlight</span>
                <h2 class="time-title">Fajr (Fast beginning)</h2>
            </div>
            <div class="countdown" id="fajr-countdown">Loading...</div>
            <div class="actual-time" id="fajr-time"></div>
        </div>

        <div class="time-card" id="sunrise-card">
            <div class="time-header">
                <span class="material-symbols-rounded">wb_twilight</span>
                <h2 class="time-title">Sunrise</h2>
            </div>
            <div class="countdown" id="sunrise-countdown">Loading...</div>
            <div class="actual-time" id="sunrise-time"></div>
        </div>

        <div class="time-card" id="sunset-card">
            <div class="time-header">
                <span class="material-symbols-rounded">light_mode</span>
                <h2 class="time-title">Sunset</h2>
            </div>
            <div class="countdown" id="sunset-countdown">Loading...</div>
            <div class="actual-time" id="sunset-time"></div>
        </div>
    </div>

<!-- Add this after your existing cards-grid div -->
<div class="weekly-view">
    <!-- Weekly cards will be inserted here dynamically -->
</div>

</div>

    <script>
        async function getLocation() {
            try {
                const position = await new Promise((resolve, reject) => {
                    navigator.geolocation.getCurrentPosition(resolve, reject);
                });
                return {
                    lat: position.coords.latitude,
                    lon: position.coords.longitude
                };
            } catch (error) {
                console.error("Error getting location:", error);
                return null;
            }
        }

        async function getLocationName(lat, lon) {
            try {
                const response = await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lon}`);
                const data = await response.json();
                return data.display_name.split(',').slice(0, 3).join(',');
            } catch (error) {
                console.error("Error getting location name:", error);
                return "Location not found";
            }
        }

        async function getSunTimes(lat, lon) {
            try {
                const response = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&daily=sunrise,sunset&timezone=auto`);
                const data = await response.json();
                return {
                    sunrise: new Date(data.daily.sunrise[0]),
                    sunset: new Date(data.daily.sunset[0])
                };
            } catch (error) {
                console.error("Error getting sun times:", error);
                return null;
            }
        }

        async function getFajrTime(lat, lon) {
            // Using the Aladhan API for prayer times
            try {
                const date = new Date();
                const response = await fetch(`https://api.aladhan.com/v1/timings/${date.getDate()}-${date.getMonth() + 1}-${date.getFullYear()}?latitude=${lat}&longitude=${lon}&method=2`);
                const data = await response.json();
                const fajrTime = data.data.timings.Fajr;
                const [hours, minutes] = fajrTime.split(':');
                const fajrDate = new Date();
                fajrDate.setHours(parseInt(hours), parseInt(minutes), 0);
                return fajrDate;
            } catch (error) {
                console.error("Error getting Fajr time:", error);
                return null;
            }
        }

        function formatCountdown(timeDiff) {
            const hours = Math.floor(Math.abs(timeDiff) / 3600000);
            const minutes = Math.floor((Math.abs(timeDiff) % 3600000) / 60000);
            const seconds = Math.floor((Math.abs(timeDiff) % 60000) / 1000);
            return `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }

        function updateCountdown(elementId, targetTime, showIfPassed = true) {
            const now = new Date();
            const timeDiff = targetTime - now;
            const element = document.getElementById(elementId);
            const card = document.getElementById(`${elementId.split('-')[0]}-card`);

            if (timeDiff < 0) {
                if (showIfPassed) {
                    element.textContent = `${formatCountdown(timeDiff)} ago`;
                    card.classList.remove('active');
                    card.classList.add('passed');
                }
            } else {
                element.textContent = `in ${formatCountdown(timeDiff)}`;
                card.classList.add('active');
                card.classList.remove('passed');
            }
        }

async function initializeApp() {
    try {
        // Show loading state
        document.getElementById('location-text').textContent = "Getting your location... üîç";
        
        const location = await getLocation();
        if (!location) {
            throw new Error("Location access denied or unavailable");
        }
        
        console.log("üìç Location retrieved:", location); // Debug logging
        
        // Here's the fixed part! üéâ
        const [locationName, sunTimes, fajrTime, weeklyTimes, weeklyFajr] = await Promise.all([
            getLocationName(location.lat, location.lon),
            getSunTimes(location.lat, location.lon),
            getFajrTime(location.lat, location.lon),
            getWeeklyTimes(location.lat, location.lon),
            getWeeklyFajrTimes(location.lat, location.lon)
        ]);

        // Update location display
        document.getElementById('location-text').textContent = locationName || "Location found! üìç (Name unavailable)";

        if (!sunTimes || !fajrTime) {
            throw new Error("Could not fetch prayer times or sun times");
        }

        // Update times display
        document.getElementById('fajr-time').textContent = `Fajr: ${fajrTime.toLocaleTimeString([], {hour: '2-digit', minute: '2-digit', hour12: true})}`;
        document.getElementById('sunrise-time').textContent = `Sunrise: ${sunTimes.sunrise.toLocaleTimeString([], {hour: '2-digit', minute: '2-digit', hour12: true})}`;
        document.getElementById('sunset-time').textContent = `Sunset: ${sunTimes.sunset.toLocaleTimeString([], {hour: '2-digit', minute: '2-digit', hour12: true})}`;

        // Create the weekly view with our new data! ‚ú®
        createWeeklyView(weeklyTimes, weeklyFajr);

        // Start the countdown updates
        setInterval(() => {
            updateCountdown('fajr-countdown', fajrTime, true);
            updateCountdown('sunrise-countdown', sunTimes.sunrise, fajrTime < new Date());
            updateCountdown('sunset-countdown', sunTimes.sunset, sunTimes.sunrise < new Date());
        }, 1000);

    } catch (error) {
        console.error("üö® App initialization error:", error);
        document.getElementById('location-text').textContent = "Oops! Something went wrong üòÖ Try refreshing!";
    }
}

        initializeApp();

// Add this new function to fetch weekly data
async function getWeeklyTimes(lat, lon) {
    try {
        const response = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&daily=sunrise,sunset&timezone=auto`);
        const data = await response.json();
        return {
            sunrise: data.daily.sunrise,
            sunset: data.daily.sunset
        };
    } catch (error) {
        console.error("Error getting weekly times:", error);
        return null;
    }
}

// Add this function to get weekly Fajr times
async function getWeeklyFajrTimes(lat, lon) {
    const days = [];
    const today = new Date();
    
    for (let i = 0; i < 7; i++) {
        const date = new Date(today);
        date.setDate(today.getDate() + i);
        const dateStr = `${date.getDate()}-${date.getMonth() + 1}-${date.getFullYear()}`;
        
        try {
            const response = await fetch(`https://api.aladhan.com/v1/timings/${dateStr}?latitude=${lat}&longitude=${lon}&method=2`);
            const data = await response.json();
            days.push(data.data.timings.Fajr);
        } catch (error) {
            console.error("Error getting Fajr time for", dateStr, error);
            days.push(null);
        }
    }
    return days;
}

// Updated createWeeklyView function with better formatting and Monday start
function createWeeklyView(weeklyTimes, weeklyFajr) {
    const weeklyView = document.querySelector('.weekly-view');
    weeklyView.innerHTML = '';
    
    // Updated to start with Monday! üéØ
    const days = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday'];
    const today = new Date();
    
    for (let i = 0; i < 7; i++) {
        const date = new Date(today);
        date.setDate(today.getDate() + i);
        
        // Adjust for Monday start
        let dayIndex = date.getDay() - 1;
        if (dayIndex === -1) dayIndex = 6; // Sunday becomes last day
        
        const dayName = i === 0 ? 'Today' : 
                       i === 1 ? 'Tomorrow' : 
                       days[dayIndex];
        
        // Convert Fajr time to proper format with AM/PM
        let formattedFajr = 'N/A';
        if (weeklyFajr[i]) {
            const [hours, minutes] = weeklyFajr[i].split(':');
            const fajrDate = new Date();
            fajrDate.setHours(parseInt(hours), parseInt(minutes), 0);
            formattedFajr = fajrDate.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit', hour12: true});
        }

        const dayCard = document.createElement('div');
        dayCard.className = 'day-card';
        dayCard.innerHTML = `
            <div class="day-name">${dayName}</div>
            <div class="time-group">
                <span class="material-symbols-rounded">nightlight</span>
                <div class="time-label">
                    <span class="label">Fajr</span>
                    <span class="time">${formattedFajr}</span>
                </div>
            </div>
            <div class="time-group">
                <span class="material-symbols-rounded">light_mode</span>
                <div class="time-label">
                    <span class="label">Sunrise</span>
                    <span class="time">${new Date(weeklyTimes.sunrise[i]).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit', hour12: true})}</span>
                </div>
            </div>
            <div class="time-group">
                <span class="material-symbols-rounded">dark_mode</span>
                <div class="time-label">
                    <span class="label">Sunset</span>
                    <span class="time">${new Date(weeklyTimes.sunset[i]).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit', hour12: true})}</span>
                </div>
            </div>
        `;
        weeklyView.appendChild(dayCard);
    }
}

// Add this to handle tab switching
document.querySelectorAll('.tab').forEach(tab => {
    tab.addEventListener('click', () => {
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        tab.classList.add('active');
        
        const view = tab.dataset.view;
        if (view === 'today') {
            document.querySelector('.cards-grid').style.display = 'grid';
            document.querySelector('.weekly-view').style.display = 'none';
        } else {
            document.querySelector('.cards-grid').style.display = 'none';
            document.querySelector('.weekly-view').style.display = 'grid';
        }
    });
});
    </script>
</body>
</html>
